<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Estadísticas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="statistics-container">

    <!-- Selector de período -->
    <ion-segment [(ngModel)]="periodo" name="periodo" (ionChange)="cambiarPeriodo()">
      <ion-segment-button value="mes">
        <ion-label>Este Mes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="meses">
        <ion-label>3 Meses</ion-label>
      </ion-segment-button>
      <ion-segment-button value="total">
        <ion-label>Total</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Card: Resumen del período -->
    <ion-card class="summary-card">
      <ion-card-header>
        <ion-card-title>Resumen del Período</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="summary-item">
          <ion-icon name="arrow-up-circle" color="success"></ion-icon>
          <div class="summary-info">
            <p class="summary-label">Ingresos</p>
            <p class="summary-value">${{resumenActual.ingresos | number:'1.0-0'}}</p>
          </div>
        </div>
        <div class="summary-item">
          <ion-icon name="arrow-down-circle" color="danger"></ion-icon>
          <div class="summary-info">
            <p class="summary-label">Gastos</p>
            <p class="summary-value">${{resumenActual.gastos | number:'1.0-0'}}</p>
          </div>
        </div>
        <div class="summary-item balance">
          <ion-icon name="wallet" color="primary"></ion-icon>
          <div class="summary-info">
            <p class="summary-label">Balance</p>
            <p class="summary-value" [style.color]="resumenActual.balance >= 0 ? 'green' : 'red'">
              ${{resumenActual.balance | number:'1.0-0'}}
            </p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Card: Comparación con mes anterior (solo si período = mes) -->
    <ion-card class="comparison-card" *ngIf="periodo === 'mes' && mostrarComparacion">
      <ion-card-header>
        <ion-card-title>Comparación con Mes Anterior</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="comparison-item">
          <p>Ingresos:</p>
          <div class="comparison-value">
            <ion-icon 
              [name]="cambioIngresos >= 0 ? 'arrow-up' : 'arrow-down'" 
              [color]="cambioIngresos >= 0 ? 'success' : 'danger'">
            </ion-icon>
            <span [style.color]="cambioIngresos >= 0 ? 'green' : 'red'">
              {{cambioIngresos}}%
            </span>
          </div>
        </div>
        <div class="comparison-item">
          <p>Gastos:</p>
          <div class="comparison-value">
            <ion-icon 
              [name]="cambioGastos >= 0 ? 'arrow-up' : 'arrow-down'" 
              [color]="cambioGastos >= 0 ? 'danger' : 'success'">
            </ion-icon>
            <span [style.color]="cambioGastos >= 0 ? 'red' : 'green'">
              {{cambioGastos}}%
            </span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Card: Gastos por Categoría con barras -->
    <ion-card class="categories-card" *ngIf="gastosPorCategoria.length > 0">
      <ion-card-header>
        <ion-card-title>Gastos por Categoría</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="category-item" *ngFor="let cat of gastosPorCategoria">
          <div class="category-header">
            <ion-icon [name]="cat.icono" [color]="cat.color"></ion-icon>
            <span class="category-name">{{cat.nombre}}</span>
            <span class="category-amount">${{cat.total | number:'1.0-0'}}</span>
          </div>
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="cat.porcentaje"
              [style.background]="getColorGradient(cat.color)">
            </div>
          </div>
          <p class="category-percentage">{{cat.porcentaje}}% del total</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Card: Historial de meses (solo si período = meses) -->
    <ion-card class="history-card" *ngIf="periodo === 'meses' && historialMeses.length > 0">
      <ion-card-header>
        <ion-card-title>Últimos 3 Meses</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let item of historialMeses" lines="full">
            <ion-label>
              <h2>{{item.mes}} {{item.anio}}</h2>
              <p>Ingresos: ${{item.ingresos | number:'1.0-0'}}</p>
              <p>Gastos: ${{item.gastos | number:'1.0-0'}}</p>
            </ion-label>
            <ion-note slot="end" [color]="item.balance >= 0 ? 'success' : 'danger'">
              ${{item.balance | number:'1.0-0'}}
            </ion-note>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Mensaje si no hay datos -->
    <ion-card *ngIf="!hayDatos">
      <ion-card-content>
        <div style="text-align: center; padding: 20px;">
          <ion-icon name="stats-chart-outline" size="large" color="medium"></ion-icon>
          <p style="color: gray; margin-top: 10px;">No hay datos suficientes para mostrar estadísticas</p>
        </div>
      </ion-card-content>
    </ion-card>

  </div>
</ion-content>